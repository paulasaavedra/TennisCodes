dbDisconnect(con)
library(dplyr)
library(tidyr)
library(kableExtra)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
#dbm <- dbm [surface =='Clay']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
#Filtra una fecha
#dbm <- dbm [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
# Filtra enero o febrero
#dbm <- dbm[month(as.Date(date_match, format = "%Y-%m-%d")) %in% c(1, 2, 3)]
#dbm <- dbm[grepl("RIO DE J", tourney_name, ignore.case = TRUE)]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [round_match=='SF']
auxi <- dbm[,.N,by=('w_player','w_nac')]
auxi <- dbm[,.N,by=c('w_player','w_nac')]
View(auxi)
dbm <- dbm [year=='2025']
auxi <- dbm[,.N,by=c('w_player','w_nac')]
View(auxi)
library(dplyr)
library(tidyr)
library(kableExtra)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
#dbm <- dbm [surface =='Clay']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
#Filtra una fecha
#dbm <- dbm [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
# Filtra enero o febrero
#dbm <- dbm[month(as.Date(date_match, format = "%Y-%m-%d")) %in% c(1, 2, 3)]
#dbm <- dbm[grepl("RIO DE J", tourney_name, ignore.case = TRUE)]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [round_match=='SF']
auxi <- dbm[,.N,by=c('date_match','w_nac')]
View(auxi)
auxi <- dbm[,.N,by=c('date_match','tourney_name','w_nac')]
auxito <- auxi [,.N,by=c('date_match','w_nac')]
View(auxito)
View(dbm)
View(dbm)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: obtener el campeón de cada torneo (jugador que ganó la final)
campeones <- dbm[round_match == "F", .(campeon = w_player), by = .(year, id)]
# Paso 2: unir con la tabla original para quedarte solo con los partidos donde jugó el campeón
# Es decir, partidos donde el campeón fue w_player o l_player en ese torneo
partidos_campeones <- merge(dbm, campeones, by = c("year", "id"))[
w_player == campeon | l_player == campeon
]
lose_by_year <- partidos_campeones [,.N,by=c('year','l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( year, l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c("year", "l_player"),
by.y = c("year", "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
View(lose_by_year)
lose_by_year <- partidos_campeones [,.N,by=c('l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c( "l_player"),
by.y = c( "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
View(lose_by_year)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: obtener el campeón de cada torneo (jugador que ganó la final)
campeones <- dbm[round_match == "F", .(campeon = w_player), by = .(year, id)]
# Paso 2: unir con la tabla original para quedarte solo con los partidos donde jugó el campeón
# Es decir, partidos donde el campeón fue w_player o l_player en ese torneo
partidos_campeones <- merge(dbm, campeones, by = c("year", "id"))[
w_player == campeon | l_player == campeon
]
lose_by_year <- partidos_campeones [,.N,by=c('year','l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( year, l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c("year", "l_player"),
by.y = c("year", "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
View(lose_by_year)
View(lose_by_year)
#### Considernando el total
lose_by_year <- partidos_campeones [,.N,by=c('l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c( "l_player"),
by.y = c( "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
View(lose_by_year)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = w_player, id, tourney_name, tourney_level)]
clasificados_por_jugador <- clasificados [,.N,by=c('player','tourney_level')]
View(clasificados_por_jugador)
clasificados_por_jugador <- clasificados [,.N,by=c('player')]
View(clasificados_por_jugador)
clasificados <- dt_last_qualy[, .(player = w_player, id, tourney_name, tourney_level, w_nac)]
clasificados_por_jugador <- clasificados [,.N,by=c('player','w_nac')]
View(clasificados_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = w_player, id, tourney_name, tourney_level, w_nac)]
clasificados_por_jugador <- clasificados [,.N,by=c('player','w_nac')]
View(clasificados_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = w_player, id, tourney_name, tourney_level, w_nac)]
clasificados_por_jugador <- clasificados [,.N,by=c('player','w_nac')]
View(clasificados_por_jugador)
View(dt_qualy)
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
View(dt_last_qualy)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
View(dt_last_qualy)
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = w_player, id, tourney_name, tourney_level, w_nac)]
View(clasificados)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = id]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = w_player, id, tourney_name, tourney_level, w_nac)]
View(clasificados)
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = year, w_player, id, tourney_name, tourney_level, w_nac)]
clasificados_por_jugador <- clasificados [,.N,by=c('player','w_nac')]
View(clasificados_por_jugador)
View(clasificados)
View(clasificados)
View(clasificados)
clasificados_por_jugador <- clasificados [,.N,by=c('w_player','w_nac')]
View(clasificados_por_jugador)
View(clasificados)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Encontrar la última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = c('id','year')]
# Paso 3: Filtrar los partidos de la última ronda de qualy de cada torneo
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Obtener los ganadores (los que pasaron a main draw)
clasificados <- dt_last_qualy[, .(player = year, w_player, id, tourney_name, tourney_level, w_nac)]
clasificados_por_jugador <- clasificados [,.N,by=c('w_player','w_nac')]
View(clasificados)
View(clasificados_por_jugador)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(kableExtra)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
#dbm <- dbm [surface =='Clay']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
#Filtra una fecha
#dbm <- dbm [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
# Filtra enero o febrero
#dbm <- dbm[month(as.Date(date_match, format = "%Y-%m-%d")) %in% c(1, 2, 3)]
#dbm <- dbm[grepl("RIO DE J", tourney_name, ignore.case = TRUE)]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025']
#dbm <- dbm [tourney_level=='M1000']
# Filtrar por id
#dbm <- dbm[id %in% c( "0308")]
ganados <- dbm[w_nac == 'Argentina']
perdidos <- dbm[l_nac=='Argentina']
ganados <- dbm[,.N, by = w_player]
perdidos <- dbm[,.N, by = l_player]
# Nombrar columnas con "Jugador" y "Ganados" "Perdidos"
names(ganados)[1] <- names(perdidos)[1] <- "Jugador"
names(ganados)[2] <- "Ganados"
names(perdidos)[2] <- "Perdidos"
# Unir resultados por nombre
resultados <- merge(ganados, perdidos, by = c("Jugador"), all=TRUE)
# Poner 0 a los que tienen NA
resultados[is.na(resultados)] <- 0
# sumar ganados y perdidos en una misma columna llamada "Jugados"
resultados <- resultados[, Jugados:=Ganados+Perdidos]
#resultados <- resultados[Jugados>4]
resultados <- resultados[, PorGan:= round(resultados$Ganados*100/resultados$Jugados, 1)]
resultados <- resultados[, PorPer:= round(resultados$Perdidos*100/resultados$Jugados, 1)]
names(resultados)[5] <- "% ganados"
names(resultados)[6] <- "% perdidos"
View(resultados)
View(dbm)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(kableExtra)
dbm <- db [tourney_level != 'CH']
# dbm <- dbm [match_status != 'Walkover']
#dbm <- dbm [surface =='Clay']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
#Filtra una fecha
#dbm <- dbm [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
# Filtra enero o febrero
#dbm <- dbm[month(as.Date(date_match, format = "%Y-%m-%d")) %in% c(1, 2, 3)]
#dbm <- dbm[grepl("RIO DE J", tourney_name, ignore.case = TRUE)]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [round_match == 'F']
finals <- dbm [,.N,by=c('year','w_nac')]
View(finals)
View(finals)
library(dplyr)
library(tidyr)
library(kableExtra)
dbm <- db [tourney_level != 'CH']
# dbm <- dbm [match_status != 'Walkover']
#dbm <- dbm [surface =='Clay']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
#Filtra una fecha
#dbm <- dbm [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
# Filtra enero o febrero
#dbm <- dbm[month(as.Date(date_match, format = "%Y-%m-%d")) %in% c(1, 2, 3)]
#dbm <- dbm[grepl("RIO DE J", tourney_name, ignore.case = TRUE)]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [round_match == 'SF']
finals <- dbm [,.N,by=c('year','w_nac')]
View(finals)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(kableExtra)
dbm <- db [tourney_level == 'CH']
# dbm <- dbm [match_status != 'Walkover']
#dbm <- dbm [surface =='Clay']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
#Filtra una fecha
#dbm <- dbm [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
# Filtra enero o febrero
#dbm <- dbm[month(as.Date(date_match, format = "%Y-%m-%d")) %in% c(1, 2, 3)]
#dbm <- dbm[grepl("RIO DE J", tourney_name, ignore.case = TRUE)]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
finals <- dbm [,.N,by=c('year','w_nac')]
View(finals)
