# Orden y acumulado
setorder(partidos_ganados, w_player, year)
partidos_ganados[, N_acumulado := cumsum(N), by = w_player]
# Top 20 jugadores (para asegurar siempre tener 10 visibles)
top_players <- partidos_ganados[, .(total = max(N_acumulado)), by = w_player][order(-total)][1:100, w_player]
partidos_ganados <- partidos_ganados[w_player %in% top_players]
# Completar datos faltantes (todos los años x top jugadores)
todos_los_anos <- unique(partidos_ganados$year)
completo <- CJ(year = todos_los_anos, w_player = top_players)
# Unir y calcular acumulado
partidos_completos <- merge(completo, partidos_ganados, by = c("year", "w_player"), all.x = TRUE)
setorder(partidos_completos, w_player, year)
partidos_completos[is.na(N), N := 0]
partidos_completos[, N_acumulado := cumsum(N), by = w_player]
# Eliminar jugadores con 0 acumulado hasta ese año
partidos_completos <- partidos_completos[N_acumulado > 0]
# Ranking por año
partidos_completos[, rank := frank(-N_acumulado, ties.method = "first"), by = year]
# Filtrar top 10 por año
partidos_top10 <- partidos_completos[rank <= 30]
# Lista de jugadores destacados
destacados <- c("Rafael Nadal", "Novak Djokovic", "Roger Federer", "Guillermo Vilas")
# Crear columna color
partidos_top10[, color := ifelse(w_player %in% destacados, w_player, "Otros")]
# Definir colores: para los destacados un color cada uno y para "Otros" un gris
colores <- c(
"Rafael Nadal" = "#E41A1C",    # rojo
"Novak Djokovic" = "#377EB8",  # azul
"Roger Federer" = "#4DAF4A",   # verde
"Guillermo Vilas" = "#9abcdf",
"Otros" = "grey80"
)
# Crear el gráfico con título y marca de agua
p <- ggplot(partidos_top10, aes(x = -rank, y = N_acumulado, fill = color)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_text(aes(label = paste0(w_player, ": ", N_acumulado)),
hjust = -0.1, color = "black", size = 4) +
scale_x_continuous(breaks = -1:-15, labels = NULL) +
coord_flip(clip = "off") +
scale_fill_manual(values = colores) +
labs(
title = 'Jugadores con más partidos ganados en Roland Garros a través de los años',
subtitle = 'Año: {closest_state}',
x = '',
y = 'Partidos ganados (acumulado)'
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 16, hjust = 0.5),
plot.margin = margin(0.5, 3, 0.5, 0.5, "cm"),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
plot.caption = element_text(size = 10, color = "gray40", hjust = 1)
) +
labs(caption = "@argentenista") +
transition_states(year, transition_length = 4, state_length = 1) +
ease_aes('cubic-in-out')
# Animar y guardar
animate(p, nframes = 500, fps = 20, width = 1000, height = 650,
renderer = gifski_renderer("bar_chart_race_colores_titulo.gif"))
View(partidos_ganados)
View(partidos_ganados)
library(data.table)
library(ggplot2)
library(gganimate)
library(dplyr)
library(tidyr)
# Filtrado de datos
dbm <- db[tourney_level != 'CH']
dbm <- dbm[match_status != 'Walkover']
dbm <- dbm[round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
# Extraer año e ID
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>% separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# Filtrar por torneo
dbm <- dbm[id == '0520']
# Partidos ganados por año y jugador
partidos_ganados <- dbm[, .N, by = .(year, w_player)]
partidos_ganados[, year := as.integer(year)]
# Orden y acumulado
setorder(partidos_ganados, w_player, year)
partidos_ganados[, N_acumulado := cumsum(N), by = w_player]
# Top 20 jugadores (para asegurar siempre tener 10 visibles)
top_players <- partidos_ganados[, .(total = max(N_acumulado)), by = w_player][order(-total)][1:100, w_player]
partidos_ganados <- partidos_ganados[w_player %in% top_players]
# Completar datos faltantes (todos los años x top jugadores)
todos_los_anos <- unique(partidos_ganados$year)
completo <- CJ(year = todos_los_anos, w_player = top_players)
# Unir y calcular acumulado
partidos_completos <- merge(completo, partidos_ganados, by = c("year", "w_player"), all.x = TRUE)
setorder(partidos_completos, w_player, year)
partidos_completos[is.na(N), N := 0]
partidos_completos[, N_acumulado := cumsum(N), by = w_player]
# Eliminar jugadores con 0 acumulado hasta ese año
partidos_completos <- partidos_completos[N_acumulado > 0]
# Ranking por año
partidos_completos[, rank := frank(-N_acumulado, ties.method = "first"), by = year]
# Filtrar top 10 por año
partidos_top10 <- partidos_completos[rank <= 30]
# Lista de jugadores destacados
destacados <- c("Rafael Nadal", "Novak Djokovic", "Roger Federer", "Guillermo Vilas")
# Crear columna color
partidos_top10[, color := ifelse(w_player %in% destacados, w_player, "Otros")]
# Definir colores: para los destacados un color cada uno y para "Otros" un gris
colores <- c(
"Rafael Nadal" = "#E41A1C",    # rojo
"Novak Djokovic" = "#377EB8",  # azul
"Roger Federer" = "#4DAF4A",   # verde
"Guillermo Vilas" = "#9abcdf",
"Otros" = "grey80"
)
# Crear el gráfico con título y marca de agua
p <- ggplot(partidos_top10, aes(x = -rank, y = N_acumulado, fill = color)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_text(aes(label = paste0(w_player, ": ", N_acumulado)),
hjust = -0.1, color = "black", size = 4) +
scale_x_continuous(breaks = -1:-15, labels = NULL) +
coord_flip(clip = "off") +
scale_fill_manual(values = colores) +
labs(
title = 'Jugadores con más partidos ganados en Roland Garros a través de los años',
subtitle = 'Año: {closest_state}',
x = '',
y = '@argentenista'
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 16, hjust = 0.5),
plot.margin = margin(0.5, 3, 0.5, 0.5, "cm"),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
plot.caption = element_text(size = 10, color = "gray40", hjust = 1)
) +
labs(caption = "@argentenista") +
transition_states(year, transition_length = 4, state_length = 1) +
ease_aes('cubic-in-out')
# Animar y guardar
animate(p, nframes = 500, fps = 20, width = 1000, height = 650,
renderer = gifski_renderer("bar_chart_race_colores_titulo.gif"))
library(data.table)
library(ggplot2)
library(gganimate)
library(dplyr)
library(tidyr)
# Filtrado de datos
dbm <- db[tourney_level != 'CH']
dbm <- dbm[match_status != 'Walkover']
dbm <- dbm[round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
# Extraer año e ID
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>% separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# Filtrar por torneo
dbm <- dbm[id == '0520']
# Partidos ganados por año y jugador
partidos_ganados <- dbm[, .N, by = .(year, w_player)]
partidos_ganados[, year := as.integer(year)]
# Orden y acumulado
setorder(partidos_ganados, w_player, year)
partidos_ganados[, N_acumulado := cumsum(N), by = w_player]
# Top 20 jugadores (para asegurar siempre tener 10 visibles)
top_players <- partidos_ganados[, .(total = max(N_acumulado)), by = w_player][order(-total)][1:100, w_player]
partidos_ganados <- partidos_ganados[w_player %in% top_players]
# Completar datos faltantes (todos los años x top jugadores)
todos_los_anos <- unique(partidos_ganados$year)
completo <- CJ(year = todos_los_anos, w_player = top_players)
# Unir y calcular acumulado
partidos_completos <- merge(completo, partidos_ganados, by = c("year", "w_player"), all.x = TRUE)
setorder(partidos_completos, w_player, year)
partidos_completos[is.na(N), N := 0]
partidos_completos[, N_acumulado := cumsum(N), by = w_player]
# Eliminar jugadores con 0 acumulado hasta ese año
partidos_completos <- partidos_completos[N_acumulado > 0]
# Ranking por año
partidos_completos[, rank := frank(-N_acumulado, ties.method = "first"), by = year]
# Filtrar top 10 por año
partidos_top10 <- partidos_completos[rank <= 30]
# Lista de jugadores destacados
destacados <- c("Rafael Nadal", "Novak Djokovic", "Roger Federer", "Guillermo Vilas")
# Crear columna color
partidos_top10[, color := ifelse(w_player %in% destacados, w_player, "Otros")]
# Definir colores: para los destacados un color cada uno y para "Otros" un gris
colores <- c(
"Rafael Nadal" = "#E41A1C",    # rojo
"Novak Djokovic" = "#377EB8",  # azul
"Roger Federer" = "#4DAF4A",   # verde
"Guillermo Vilas" = "#9abcdf",
"Otros" = "grey80"
)
# Crear el gráfico con título y marca de agua
p <- ggplot(partidos_top10, aes(x = -rank, y = N_acumulado, fill = color)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_text(aes(label = paste0(w_player, ": ", N_acumulado)),
hjust = -0.1, color = "black", size = 4) +
scale_x_continuous(breaks = -1:-15, labels = NULL) +
coord_flip(clip = "off") +
scale_fill_manual(values = colores) +
labs(
title = 'Jugadores con más partidos ganados en Roland Garros a través de los años',
subtitle = 'Año: {closest_state}',
x = '',
y = '@argentenista'
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 16, hjust = 0.5),
plot.margin = margin(0.5, 3, 0.5, 0.5, "cm"),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
plot.caption = element_text(size = 10, color = "gray40", hjust = 1)
) +
labs(caption = "") +
transition_states(year, transition_length = 4, state_length = 1) +
ease_aes('cubic-in-out')
# Animar y guardar
animate(p, nframes = 500, fps = 20, width = 1000, height = 650,
renderer = gifski_renderer("bar_chart_race_colores_titulo.gif"))
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
View(db)
setwd("~/Documents/TennisData/TennisCodes/analysis")
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(kableExtra)
library(stringr)
dbm <- db [tourney_level!='CH']
dbm <- dbm [match_status!= 'Walkover']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
View(db)
dbm <- dbm[best==5]
dbm <- dbm %>%
mutate(
sets = strsplit(match_score_clean, " "),
Dado_vuelta = sapply(sets, function(set) {
# Verificamos que haya al menos 5 sets
if (length(set) >= 5) {
# Extraemos todos los sets y los convertimos en pares numéricos
scores <- lapply(set[1:5], function(s) suppressWarnings(as.numeric(unlist(strsplit(s, "-")))))
# Verificamos que todos los sets tengan dos números válidos
if (all(sapply(scores, function(s) length(s) == 2 && all(!is.na(s))))) {
# Extraemos los resultados
p1_wins <- sapply(scores, function(s) s[1] > s[2])
p2_wins <- sapply(scores, function(s) s[1] < s[2])
# Verificamos si el jugador 1 ganó los 2 primeros sets y perdió los 3 siguientes
if (p1_wins[1] && p1_wins[2] && all(p2_wins[3:5])) {
return("SI")
}
}
}
return("NO")
})
)
View(dbm)
View(dbm)
View(dbm)
dbm <- dbm %>%
mutate(
sets = strsplit(match_score_clean, " "),
Dado_vuelta = sapply(sets, function(set) {
if (length(set) >= 5) {
# Convertimos cada set a vector numérico [jug1, jug2]
scores <- lapply(set[1:5], function(s) {
nums <- suppressWarnings(as.numeric(unlist(strsplit(s, "-"))))
return(nums)
})
# Verificamos que todos los sets tengan dos números válidos
if (all(sapply(scores, function(s) length(s) == 2 && all(!is.na(s))))) {
# Jugador 1 gana los 2 primeros
gana_1y2 <- scores[[1]][1] > scores[[1]][2] && scores[[2]][1] > scores[[2]][2]
# Jugador 2 gana los últimos 3
pierde_3a5 <- all(sapply(scores[3:5], function(s) s[1] < s[2]))
if (gana_1y2 && pierde_3a5) {
return("SI")
}
}
}
return("NO")
})
)
View(dbm)
dbm <- dbm %>%
mutate(
sets = strsplit(match_score_clean, " "),
Dado_vuelta = sapply(sets, function(set) {
# Verificamos que haya al menos 5 sets
if (length(set) >= 5) {
# Intentamos extraer los sets de forma segura
s1 <- suppressWarnings(as.numeric(unlist(strsplit(set[1], "-"))))
s2 <- suppressWarnings(as.numeric(unlist(strsplit(set[2], "-"))))
s3 <- suppressWarnings(as.numeric(unlist(strsplit(set[3], "-"))))
s4 <- suppressWarnings(as.numeric(unlist(strsplit(set[5], "-"))))
s5 <- suppressWarnings(as.numeric(unlist(strsplit(set[5], "-"))))
# Verificamos que cada set tenga dos números válidos
if (
length(s1) == 2 && length(s2) == 2 && length(s3) == 2 && length(s4) == 2 && length(s5) == 2 &&
all(!is.na(c(s1, s2, s3, s4, s5)))
) {
if (s1[1] < s1[2] && s2[1] < s2[2] && s3[1] > s3[2] && s4[1] > s4[2] && s5[1] > s5[2]) {
return("SI")
}
}
}
return("NO")
})
)
remontados <- dbm [Dado_vuelta=='SI']
View(remontados)
auxi <- remontados[,.N,by=c('year','tourney_name')]
View(auxi)
library(dplyr)
library(tidyr)
library(kableExtra)
library(stringr)
library(dplyr)
library(ggplot2)
# Paso 1: Filtrar y quedarnos solo con Roland Garros en los últimos 10 años
roland_data <- remontadas_por_torneo %>%
filter(tourney_name == "Roland Garros", year >= 2015)
remontadas_por_torneo <- remontados[,.N,by=c('year','tourney_name')]
# Paso 1: Filtrar y quedarnos solo con Roland Garros en los últimos 10 años
roland_data <- remontadas_por_torneo %>%
filter(tourney_name == "Roland Garros", year >= 2015)
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = 2025, tourney_name = "Roland Garros", N = 7)
)
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = 2025, tourney_name = "Roland Garros", N = 7)
)
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = '2025', tourney_name = "Roland Garros", N = 7)
)
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar con etiquetas de número
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
geom_text(aes(label = N), vjust = -0.5, color = "black", size = 4) +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
View(db)
# Paso 1: Filtrar y quedarnos solo con Roland Garros en los últimos 10 años
roland_data <- remontadas_por_torneo %>%
filter(tourney_name == "Roland Garros", year >= 2000)
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = '2025', tourney_name = "Roland Garros", N = 7)
)
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar con etiquetas de número
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
geom_text(aes(label = N), vjust = -0.5, color = "black", size = 4) +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
# Paso 1: Filtrar y quedarnos solo con Roland Garros en los últimos 10 años
roland_data <- remontadas_por_torneo %>%
filter(tourney_name == "Roland Garros", year >= 2005)
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = '2025', tourney_name = "Roland Garros", N = 7)
)
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar con etiquetas de número
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
geom_text(aes(label = N), vjust = -0.5, color = "black", size = 4) +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
# Paso 1: Filtrar y quedarnos solo con Roland Garros en los últimos 10 años
roland_data <- remontadas_por_torneo %>%
filter(tourney_name == "Roland Garros", year >= 2004)
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = '2025', tourney_name = "Roland Garros", N = 7)
)
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar con etiquetas de número
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
geom_text(aes(label = N), vjust = -0.5, color = "black", size = 4) +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
# Paso 1: Filtrar y quedarnos solo con Roland Garros en los últimos 10 años
roland_data <- remontadas_por_torneo %>%
filter(tourney_name == "Roland Garros", year >= 2003)
# Paso 2: Agregar 2025 manualmente
roland_data <- bind_rows(
roland_data,
data.frame(year = '2025', tourney_name = "Roland Garros", N = 7)
)
# Paso 3: Ordenar por año por si no está ordenado
roland_data <- roland_data %>%
arrange(year)
# Paso 4: Graficar con etiquetas de número
ggplot(roland_data, aes(x = factor(year), y = N)) +
geom_bar(stat = "identity", fill = "#0072B2") +
geom_text(aes(label = N), vjust = -0.5, color = "black", size = 4) +
labs(
title = "Remontadas en Roland Garros (últimos 10 años)",
x = "Año",
y = "Cantidad de remontadas"
) +
theme_minimal()
