)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
View(dbm)
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
View(resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("w_player", "l_player")]
View(total_partidos)
total_partidos <- melt(total_partidos, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(total_partidos, "N", "partidos_jugados")
View(total_partidos)
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("match_id","w_player", "l_player")]
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("match_id","w_player", "l_player")]
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("match_id","w_player", "l_player")]
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("tourney_name","w_player", "l_player")]
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("tourney_name","w_player", "l_player")]
total_partidos <- melt(total_partidos, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(total_partidos, "N", "partidos_jugados")
# Calcular partidos jugados a 3 sets (w_player + l_player cuando count_sets == 3)
partidos_3_sets <- dbm[count_sets == 3, .N, by = c("w_player", "l_player")]
partidos_3_sets <- melt(partidos_3_sets, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(partidos_3_sets, "N", "partidos_a_3_sets")
# Unir los datos
resumen <- merge(resumen, total_partidos, by = "player", all.x = TRUE)
resumen <- merge(resumen, partidos_3_sets, by = "player", all.x = TRUE)
# Reemplazar NA por 0 en partidos_a_3_sets
resumen[is.na(partidos_a_3_sets), partidos_a_3_sets := 0]
# Calcular la proporción de partidos a 3 sets sobre el total de partidos jugados
resumen[, prop_partidos_a_3_sets := (partidos_a_3_sets / partidos_jugados) * 100]
View(resumen)
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
dbm <- dbm [tourney_level != 'CH']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("tourney_name","w_player", "l_player")]
total_partidos <- melt(total_partidos, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(total_partidos, "N", "partidos_jugados")
# Calcular partidos jugados a 3 sets (w_player + l_player cuando count_sets == 3)
partidos_3_sets <- dbm[count_sets == 3, .N, by = c("w_player", "l_player")]
partidos_3_sets <- melt(partidos_3_sets, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(partidos_3_sets, "N", "partidos_a_3_sets")
# Unir los datos
resumen <- merge(resumen, total_partidos, by = "player", all.x = TRUE)
resumen <- merge(resumen, partidos_3_sets, by = "player", all.x = TRUE)
# Reemplazar NA por 0 en partidos_a_3_sets
resumen[is.na(partidos_a_3_sets), partidos_a_3_sets := 0]
# Calcular la proporción de partidos a 3 sets sobre el total de partidos jugados
resumen[, prop_partidos_a_3_sets := (partidos_a_3_sets / partidos_jugados) * 100]
View(resumen)
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("tourney_name","w_player", "l_player")]
total_partidos <- melt(total_partidos, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(total_partidos, "N", "partidos_jugados")
# Calcular partidos jugados a 3 sets (w_player + l_player cuando count_sets == 3)
partidos_3_sets <- dbm[count_sets == 3, .N, by = c("w_player", "l_player")]
partidos_3_sets <- melt(partidos_3_sets, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(partidos_3_sets, "N", "partidos_a_3_sets")
# Unir los datos
resumen <- merge(resumen, total_partidos, by = "player", all.x = TRUE)
resumen <- merge(resumen, partidos_3_sets, by = "player", all.x = TRUE)
# Reemplazar NA por 0 en partidos_a_3_sets
resumen[is.na(partidos_a_3_sets), partidos_a_3_sets := 0]
# Calcular la proporción de partidos a 3 sets sobre el total de partidos jugados
resumen[, prop_partidos_a_3_sets := (partidos_a_3_sets / partidos_jugados) * 100]
View(resumen)
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
dbm <- db [ match_status != 'Walkover']
dbm <- dbm [tourney_level != 'CH']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year=='2025' & best == 3]
dbm[, count_sets := str_count(score, "-")]
# Obtener jugadores únicos
resumen <- unique(c(dbm$w_player, dbm$l_player))
resumen <- data.table(player = resumen)
# Calcular partidos jugados (w_player + l_player)
total_partidos <- dbm[, .N, by = c("tourney_name","w_player", "l_player")]
total_partidos <- melt(total_partidos, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(total_partidos, "N", "partidos_jugados")
# Calcular partidos jugados a 3 sets (w_player + l_player cuando count_sets == 3)
partidos_3_sets <- dbm[count_sets == 3, .N, by = c("w_player", "l_player")]
partidos_3_sets <- melt(partidos_3_sets, measure.vars = c("w_player", "l_player"), value.name = "player")[, .N, by = player]
setnames(partidos_3_sets, "N", "partidos_a_3_sets")
# Unir los datos
resumen <- merge(resumen, total_partidos, by = "player", all.x = TRUE)
resumen <- merge(resumen, partidos_3_sets, by = "player", all.x = TRUE)
# Reemplazar NA por 0 en partidos_a_3_sets
resumen[is.na(partidos_a_3_sets), partidos_a_3_sets := 0]
# Calcular la proporción de partidos a 3 sets sobre el total de partidos jugados
resumen[, prop_partidos_a_3_sets := (partidos_a_3_sets / partidos_jugados) * 100]
View(resumen)
library(dplyr)
library(tidyr)
library(data.table)
library (stringr)
dbm <- db [tourney_level!='CH']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
# Contar cuántos sets ganados fueron 7-6 (tiebreaks ganados)
dbm[, tb_wins := lengths(regmatches(match_score_clean, gregexpr("7-6", match_score_clean)))]
#tiebreak_ganados <- dbm [w_nac =='Argentina' & tb_wins > 1]
# Contar tiebreaks jugados
dbm[, w_tiebreak := str_count(match_score_clean, "7-6")]
dbm[, l_tiebreak := str_count(match_score_clean, "6-7")]
dbm <- dbm [year == "2025"]
dbm[, w_tb_ganados := str_count(match_score_clean, "\\b7-6\\b")]
dbm[, w_tb_perdidos := str_count(match_score_clean, "\\b6-7\\b")]
dbm[, l_tb_ganados := w_tb_perdidos]
dbm[, l_tb_perdidos := w_tb_ganados]
# Ganador del partido
tb_winner <- dbm[, .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[, .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
# Ganador del partido
tb_winner <- dbm[w_nac=='Argentina', .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[l_nac=='Argentina', .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
# Ganador del partido
tb_winner <- dbm[, .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[, .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
library (stringr)
dbm <- db [tourney_level!='CH']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
# Contar cuántos sets ganados fueron 7-6 (tiebreaks ganados)
dbm[, tb_wins := lengths(regmatches(match_score_clean, gregexpr("7-6", match_score_clean)))]
#tiebreak_ganados <- dbm [w_nac =='Argentina' & tb_wins > 1]
# Contar tiebreaks jugados
dbm[, w_tiebreak := str_count(match_score_clean, "7-6")]
dbm[, l_tiebreak := str_count(match_score_clean, "6-7")]
dbm <- dbm [year == "2025"]
dbm[, w_tb_ganados := str_count(match_score_clean, "\\b7-6\\b")]
dbm[, w_tb_perdidos := str_count(match_score_clean, "\\b6-7\\b")]
dbm[, l_tb_ganados := w_tb_perdidos]
dbm[, l_tb_perdidos := w_tb_ganados]
# Ganador del partido
tb_winner <- dbm[w_nac == 'Argentina', .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[l_nac == 'Argentina', .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
library (stringr)
dbm <- db
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
# Contar cuántos sets ganados fueron 7-6 (tiebreaks ganados)
dbm[, tb_wins := lengths(regmatches(match_score_clean, gregexpr("7-6", match_score_clean)))]
#tiebreak_ganados <- dbm [w_nac =='Argentina' & tb_wins > 1]
# Contar tiebreaks jugados
dbm[, w_tiebreak := str_count(match_score_clean, "7-6")]
dbm[, l_tiebreak := str_count(match_score_clean, "6-7")]
dbm <- dbm [year == "2025"]
dbm[, w_tb_ganados := str_count(match_score_clean, "\\b7-6\\b")]
dbm[, w_tb_perdidos := str_count(match_score_clean, "\\b6-7\\b")]
dbm[, l_tb_ganados := w_tb_perdidos]
dbm[, l_tb_perdidos := w_tb_ganados]
# Ganador del partido
tb_winner <- dbm[w_nac == 'Argentina', .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[l_nac == 'Argentina', .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
library (stringr)
dbm <- db [tourney_level!='CH']
#dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
# Contar cuántos sets ganados fueron 7-6 (tiebreaks ganados)
dbm[, tb_wins := lengths(regmatches(match_score_clean, gregexpr("7-6", match_score_clean)))]
#tiebreak_ganados <- dbm [w_nac =='Argentina' & tb_wins > 1]
# Contar tiebreaks jugados
dbm[, w_tiebreak := str_count(match_score_clean, "7-6")]
dbm[, l_tiebreak := str_count(match_score_clean, "6-7")]
dbm <- dbm [year == "2025"]
dbm[, w_tb_ganados := str_count(match_score_clean, "\\b7-6\\b")]
dbm[, w_tb_perdidos := str_count(match_score_clean, "\\b6-7\\b")]
dbm[, l_tb_ganados := w_tb_perdidos]
dbm[, l_tb_perdidos := w_tb_ganados]
# Ganador del partido
tb_winner <- dbm[w_nac == 'Argentina', .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[l_nac == 'Argentina', .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
library(dplyr)
library(tidyr)
library(data.table)
library (stringr)
dbm <- db
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
# Contar cuántos sets ganados fueron 7-6 (tiebreaks ganados)
dbm[, tb_wins := lengths(regmatches(match_score_clean, gregexpr("7-6", match_score_clean)))]
#tiebreak_ganados <- dbm [w_nac =='Argentina' & tb_wins > 1]
# Contar tiebreaks jugados
dbm[, w_tiebreak := str_count(match_score_clean, "7-6")]
dbm[, l_tiebreak := str_count(match_score_clean, "6-7")]
dbm <- dbm [year == "2025"]
dbm[, w_tb_ganados := str_count(match_score_clean, "\\b7-6\\b")]
dbm[, w_tb_perdidos := str_count(match_score_clean, "\\b6-7\\b")]
dbm[, l_tb_ganados := w_tb_perdidos]
dbm[, l_tb_perdidos := w_tb_ganados]
# Ganador del partido
tb_winner <- dbm[w_nac == 'Argentina', .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[l_nac == 'Argentina', .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
View(dbm)
View(tiebreaks_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
library (stringr)
dbm <- db [tourney_level!='CH']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, match_score_clean := gsub("\\(\\d+\\)", "", score)]
# Contar cuántos sets ganados fueron 7-6 (tiebreaks ganados)
dbm[, tb_wins := lengths(regmatches(match_score_clean, gregexpr("7-6", match_score_clean)))]
#tiebreak_ganados <- dbm [w_nac =='Argentina' & tb_wins > 1]
# Contar tiebreaks jugados
dbm[, w_tiebreak := str_count(match_score_clean, "7-6")]
dbm[, l_tiebreak := str_count(match_score_clean, "6-7")]
dbm <- dbm [year == "2025"]
dbm[, w_tb_ganados := str_count(match_score_clean, "\\b7-6\\b")]
dbm[, w_tb_perdidos := str_count(match_score_clean, "\\b6-7\\b")]
dbm[, l_tb_ganados := w_tb_perdidos]
dbm[, l_tb_perdidos := w_tb_ganados]
# Ganador del partido
tb_winner <- dbm[w_nac == 'Argentina', .(jugador = w_player,
tiebreaks_ganados = w_tb_ganados,
tiebreaks_perdidos = w_tb_perdidos)]
# Perdedor del partido
tb_loser <- dbm[l_nac == 'Argentina', .(jugador = l_player,
tiebreaks_ganados = l_tb_ganados,
tiebreaks_perdidos = l_tb_perdidos)]
# Combinar y agrupar
tiebreaks_por_jugador <- rbind(tb_winner, tb_loser)[, .(
tiebreaks_ganados = sum(tiebreaks_ganados, na.rm = TRUE),
tiebreaks_perdidos = sum(tiebreaks_perdidos, na.rm = TRUE)
), by = jugador]
# Calcular totales y porcentaje
tiebreaks_por_jugador[, tiebreaks_jugados := tiebreaks_ganados + tiebreaks_perdidos]
tiebreaks_por_jugador[, pct_tiebreaks_ganados :=
fifelse(tiebreaks_jugados > 0,
round(100 * tiebreaks_ganados / tiebreaks_jugados, 1),
NA_real_)]
View(tiebreaks_por_jugador)
