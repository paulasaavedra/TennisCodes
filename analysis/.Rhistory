library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
auxi <- db [tourney_level=='DC' & l_player=='Argentina']
auxito <- auxi[,.N,by=c(w_player)]
auxi <- db [tourney_level=='DC' & l_nac=='Argentina']
auxito <- auxi[,.N,by=c('l_player')]
View(auxito)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
auxi <- db [tourney_level=='M1000' & w_nac=='Argentina' & round_match=='R16']
auxito <- auxi[,.N,by=c('l_player')]
View(auxito)
auxito <- auxi[,.N,by=c('w_player')]
auxi <- db [tourney_level=='M1000' & w_nac=='Argentina' & round_match=='R16' & surface=='Hard']
auxito <- auxi[,.N,by=c('w_player')]
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# CLASIFICADOS
# -------------------------
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = c("id","year")]
# Paso 3: Partidos de la última ronda
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Ganadores que pasan a main draw
clasificados <- dt_last_qualy[, .(player = w_player, nac = w_nac, id, tourney_name, tourney_level, year)]
clasificados_unicos <- unique(clasificados[, .(player, nac)])
# -------------------------
# JUGADORES QUE NUNCA CLASIFICARON
# -------------------------
# 1. Partidos de qualy jugados (como perdedor)
qualy_losers <- dt_qualy[, .N, by = .(player = l_player, nac = l_nac)]
# 2. Partidos de qualy jugados (como ganador)
qualy_winners <- dt_qualy[, .N, by = .(player = w_player, nac = w_nac)]
# 3. Unir ambos
qualy_total <- rbindlist(list(qualy_losers, qualy_winners), fill = TRUE)
qualy_total <- qualy_total[, .(matches_qualy = sum(N, na.rm=TRUE)), by=.(player, nac)]
# 4. Filtrar jugadores que nunca clasificaron
nunca_clasificaron <- qualy_total[!player %in% clasificados_unicos$player]
# 5. Ordenar por más qualies jugadas
nunca_clasificaron <- nunca_clasificaron[order(-matches_qualy)]
View(nunca_clasificaron)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level == 'GS' ]
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# CLASIFICADOS
# -------------------------
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = c("id","year")]
# Paso 3: Partidos de la última ronda
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Ganadores que pasan a main draw
clasificados <- dt_last_qualy[, .(player = w_player, nac = w_nac, id, tourney_name, tourney_level, year)]
clasificados_unicos <- unique(clasificados[, .(player, nac)])
# -------------------------
# JUGADORES QUE NUNCA CLASIFICARON
# -------------------------
# 1. Partidos de qualy jugados (como perdedor)
qualy_losers <- dt_qualy[, .N, by = .(player = l_player, nac = l_nac)]
# 2. Partidos de qualy jugados (como ganador)
qualy_winners <- dt_qualy[, .N, by = .(player = w_player, nac = w_nac)]
# 3. Unir ambos
qualy_total <- rbindlist(list(qualy_losers, qualy_winners), fill = TRUE)
qualy_total <- qualy_total[, .(matches_qualy = sum(N, na.rm=TRUE)), by=.(player, nac)]
# 4. Filtrar jugadores que nunca clasificaron
nunca_clasificaron <- qualy_total[!player %in% clasificados_unicos$player]
# 5. Ordenar por más qualies jugadas
nunca_clasificaron <- nunca_clasificaron[order(-matches_qualy)]
View(nunca_clasificaron)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level == 'GS' ]
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# CLASIFICADOS
# -------------------------
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = c("id","year")]
# Paso 3: Partidos de la última ronda
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Ganadores que pasan a main draw
clasificados <- dt_last_qualy[, .(player = w_player, nac = w_nac, id, year)]
clasificados_unicos <- unique(clasificados[, .(player, nac)])
# -------------------------
# JUGADORES QUE NUNCA CLASIFICARON
# -------------------------
# 1. Torneos de qualy jugados como perdedor
torneos_losers <- dt_qualy[, .(torneos_qualy = uniqueN(paste(id, year))),
by = .(player = l_player, nac = l_nac)]
# 2. Torneos de qualy jugados como ganador
torneos_winners <- dt_qualy[, .(torneos_qualy = uniqueN(paste(id, year))),
by = .(player = w_player, nac = w_nac)]
# 3. Unir ambos (sumando torneos jugados)
torneos_total <- rbindlist(list(torneos_losers, torneos_winners), fill = TRUE)
torneos_total <- torneos_total[, .(torneos_qualy = sum(torneos_qualy, na.rm=TRUE)),
by=.(player, nac)]
# 4. Filtrar jugadores que nunca clasificaron
nunca_clasificaron <- torneos_total[!player %in% clasificados_unicos$player]
# 5. Ordenar por más torneos jugados sin clasificar
nunca_clasificaron <- nunca_clasificaron[order(-torneos_qualy)]
View(nunca_clasificaron)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level == 'GS' ]
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = c("id","year")]
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level != 'CH']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# CLASIFICADOS
# -------------------------
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = .(id, year)]
# Paso 3: Partidos de la última ronda
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Ganadores que pasan a main draw
clasificados <- dt_last_qualy[, .(player = w_player, nac = w_nac, id, year)]
clasificados_unicos <- unique(clasificados[, .(player, nac)])
# -------------------------
# TORNEOS DE QUALY JUGADOS
# -------------------------
# 1. Todos los jugadores que participaron en un torneo de qualy
players_in_qualy <- rbind(
dt_qualy[, .(player = w_player, nac = w_nac, id, year)],
dt_qualy[, .(player = l_player, nac = l_nac, id, year)]
)
players_in_qualy <- unique(players_in_qualy)
# 2. Contar cuántos torneos de qualy jugó cada jugador
torneos_por_jugador <- players_in_qualy[, .(torneos_qualy = .N), by = .(player, nac)]
# 3. Filtrar los que NUNCA clasificaron
nunca_clasificaron <- torneos_por_jugador[!player %in% clasificados_unicos$player]
# 4. Ordenar por más torneos jugados sin clasificar
nunca_clasificaron <- nunca_clasificaron[order(-torneos_qualy)]
View(nunca_clasificaron)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level == 'GS']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# CLASIFICADOS
# -------------------------
# Paso 1: Filtrar solo las rondas de qualy
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Paso 2: Última ronda de qualy por torneo
dt_qualy[, max_qualy_round := max(round_match), by = .(id, year)]
# Paso 3: Partidos de la última ronda
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# Paso 4: Ganadores que pasan a main draw
clasificados <- dt_last_qualy[, .(player = w_player, nac = w_nac, id, year)]
clasificados_unicos <- unique(clasificados[, .(player, nac)])
# -------------------------
# TORNEOS DE QUALY JUGADOS
# -------------------------
# 1. Todos los jugadores que participaron en un torneo de qualy
players_in_qualy <- rbind(
dt_qualy[, .(player = w_player, nac = w_nac, id, year)],
dt_qualy[, .(player = l_player, nac = l_nac, id, year)]
)
players_in_qualy <- unique(players_in_qualy)
# 2. Contar cuántos torneos de qualy jugó cada jugador
torneos_por_jugador <- players_in_qualy[, .(torneos_qualy = .N), by = .(player, nac)]
# 3. Filtrar los que NUNCA clasificaron
nunca_clasificaron <- torneos_por_jugador[!player %in% clasificados_unicos$player]
# 4. Ordenar por más torneos jugados sin clasificar
nunca_clasificaron <- nunca_clasificaron[order(-torneos_qualy)]
View(nunca_clasificaron)
View(torneos_por_jugador)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level == 'GS']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# QUALY
# -------------------------
# Filtrar solo qualies
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Identificar última ronda de qualy en cada torneo
dt_qualy[, max_qualy_round := max(round_match), by = .(id, year)]
# -------------------------
# JUGADORES EN CADA TORNEO
# -------------------------
# Todos los jugadores que participaron en qualy
players_in_qualy <- rbind(
dt_qualy[, .(player = w_player, nac = w_nac, id, year, round_match, max_qualy_round, result = "W")],
dt_qualy[, .(player = l_player, nac = l_nac, id, year, round_match, max_qualy_round, result = "L")]
)
# -------------------------
# CLASIFICACIÓN POR TORNEO
# -------------------------
# Un torneo está "clasificado" para un jugador si ganó la última ronda
clasificados_torneo <- players_in_qualy[
round_match == max_qualy_round & result == "W",
.(clasifico = 1),
by = .(player, id, year)
]
# Merge con todos los jugadores que entraron en la qualy
torneos_jugador <- unique(players_in_qualy[, .(player, nac, id, year)])
torneos_jugador <- merge(
torneos_jugador,
clasificados_torneo,
by = c("player","id","year"),
all.x = TRUE
)
torneos_jugador[is.na(clasifico), clasifico := 0]
# -------------------------
# CONTEOS FINALES
# -------------------------
resumen <- torneos_jugador[, .(
torneos_qualy = .N,
torneos_clasificados = sum(clasifico)
), by = .(player, nac)]
# Filtrar los que nunca clasificaron
nunca_clasificaron <- resumen[torneos_clasificados == 0][order(-torneos_qualy)]
View(nunca_clasificaron)
library(dplyr)
library(tidyr)
library(data.table)
# -------------------------
# PREPARACIÓN DE LA BASE
# -------------------------
dbm <- db[tourney_level == 'GS']
# dbm <- db [as.Date(date_match, format = "%Y-%m-%d") > as.Date("2024-12-20")]
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# -------------------------
# QUALY
# -------------------------
# Filtrar solo qualies
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# Todos los jugadores que jugaron qualy en algún torneo
jugadores_qualy <- dt_qualy[, .(id, year, player = w_player, nac = w_nac, tourney_name, tourney_level)]
# Agregamos también los perdedores de qualy (para que no se pierdan)
jugadores_qualy <- rbind(
jugadores_qualy,
dt_qualy[, .(id, year, player = l_player, nac = l_nac, tourney_name, tourney_level)]
)
# Lista de jugadores que alguna vez superaron la qualy
clasificados_jugadores <- unique(clasificados$w_player)
# Filtrar los que NUNCA clasificaron
jugadores_nunca <- jugadores_qualy[!(player %in% clasificados_jugadores)]
# Contar cantidad de torneos jugados por cada jugador que nunca superó la qualy
torneos_nunca <- jugadores_nunca[, .N, by = .(player, nac)]
setorder(torneos_nunca, -N)  # ordenado de mayor a menor
View(torneos_nunca)
library(dplyr)
library(tidyr)
library(data.table)
# --- Preprocesamiento ---
dbm <- db[tourney_level == 'GS']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# --- Paso 1: Filtrar solo las rondas de qualy ---
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# --- Paso 2: Encontrar la última ronda de qualy por torneo ---
dt_qualy[, max_qualy_round := max(round_match), by = c('id','year')]
# --- Paso 3: Partidos de la última ronda de qualy ---
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# --- Paso 4: Jugadores clasificados al main draw ---
clasificados <- dt_last_qualy[, .(player = year,
w_player,
id,
tourney_name,
tourney_level,
w_nac)]
clasificados_por_jugador <- clasificados[, .N, by = c('w_player','w_nac')]
# --- Paso 5: Todos los jugadores que participaron en qualy (ganadores y perdedores) ---
jugadores_qualy <- rbind(
dt_qualy[, .(id, year, player = w_player, nac = w_nac)],
dt_qualy[, .(id, year, player = l_player, nac = l_nac)]
)
# --- Paso 6: Lista de jugadores que alguna vez superaron la qualy ---
clasificados_jugadores <- unique(clasificados$w_player)
# --- Paso 7: Filtrar jugadores que NUNCA clasificaron ---
jugadores_nunca <- jugadores_qualy[!(player %in% clasificados_jugadores)]
# --- Paso 8: Contar torneos distintos de qualy jugados ---
torneos_nunca <- jugadores_nunca[, .(torneos = uniqueN(paste(id, year))),
by = .(player, nac)]
setorder(torneos_nunca, -torneos)
View(torneos_nunca)
View(dbm)
View(dbm)
View(db)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
# setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
# setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
# setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(dplyr)
library(tidyr)
library(data.table)
# --- Preprocesamiento ---
dbm <- db[tourney_level == 'GS']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)
dbm[, id := as.character(id)]
# --- Paso 1: Filtrar solo las rondas de qualy ---
dt_qualy <- dbm[grepl("^Q[1-9]$", round_match)]
# --- Paso 2: Encontrar la última ronda de qualy por torneo ---
dt_qualy[, max_qualy_round := max(round_match), by = c('id','year')]
# --- Paso 3: Partidos de la última ronda de qualy ---
dt_last_qualy <- dt_qualy[round_match == max_qualy_round]
# --- Paso 4: Jugadores clasificados al main draw ---
clasificados <- dt_last_qualy[, .(player = year,
w_player,
id,
tourney_name,
tourney_level,
w_nac)]
clasificados_por_jugador <- clasificados[, .N, by = c('w_player','w_nac')]
# --- Paso 5: Todos los jugadores que participaron en qualy (ganadores y perdedores) ---
jugadores_qualy <- rbind(
dt_qualy[, .(id, year, player = w_player, nac = w_nac)],
dt_qualy[, .(id, year, player = l_player, nac = l_nac)]
)
# --- Paso 6: Lista de jugadores que alguna vez superaron la qualy ---
clasificados_jugadores <- unique(clasificados$w_player)
# --- Paso 7: Filtrar jugadores que NUNCA clasificaron ---
jugadores_nunca <- jugadores_qualy[!(player %in% clasificados_jugadores)]
# --- Paso 8: Contar torneos distintos de qualy jugados ---
torneos_nunca <- jugadores_nunca[, .(torneos = uniqueN(paste(id, year))),
by = .(player, nac)]
setorder(torneos_nunca, -torneos)
View(torneos_nunca)
View(db)
