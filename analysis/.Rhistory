CH125,Australia
CH100,New Caledonia
CH75,Thailand
CH75,Thailand
CH75,Great Britain
CH75,Portugal
CH100,Portugal
CH75,Thailand
CH50,Argentina
CH75,Uruguay
CH125,France
CH100,Portugal
CH100,Brazil
CH100,Germany
CH75,Australia
CH75,United States
CH125,France
CH125,Argentina
CH100,India
CH75,Australia
CH75,Spain
CH125,Bahrain
CH75,India
CH75,Spain
CH125,France
CH100,India
CH75,Great Britain
CH50,Republic of Congo
CH125,India
CH100,United States
CH75,Rwanda
CH75,Switzerland
CH100,Rwanda
CH75,Argentina
CH75,France
CH50,Greece
CH75,Chile
CH75,France
CH50,Greece
CH175,United States
CH175,Dominican Republic
CH75,Paraguay
CH75,Mexico
CH75,Spain
CH75,Croatia
CH125,Italy
CH100,Spain
CH75,Chile
CH100,Spain
CH75,Brazil
CH75,Mexico
CH75,Italy
CH125,Mexico
CH125,Mexico
CH100,Italy
CH100,Spain
CH75,United States
CH125,South Korea
CH125,Portugal
CH75,Mexico
CH75,United States
CH50,Ivory Coast
CH75,South Korea
CH75,United States
CH50,Argentina
CH50,Ivory Coast
CH50,Italy
CH175,Portugal
CH100,Austria
CH75,China
CH75,Czechia
CH50,Brazil
CH175,France
CH100,China
CH75,Czechia
CH75,Italy
CH50,Brazil
CH100,Portugal
CH75,Tunisia
CH75,Croatia
CH50,Colombia
CH175,France
CH175,Italy
CH75,North Macedonia
CH50,Georgia
CH75,United States
CH75,Italy
CH50,Moldova
CH125,Great Britain
CH100,Germany
CH100,Czechia
CH75,United States
CH125,Italy
CH125,Great Britain
CH100,Slovak Republic
CH100,France
CH50,Argentina
CH125,Italy
CH125,Great Britain
CH100,Poland
CH50,Bolivia
CH50,France
CH75,Italy
CH50,Peru
CH75,United States
CH75,Romania
CH75,Italy
CH50,France
CH125,United States
CH125,Germany
CH100,Romania
CH100,Italy
CH75,Canada
CH50,Great Britain
CH125,San Marino
CH75,Canada
CH75,Netherlands
CH75,Spain
CH125,Switzerland
CH100,United States
CH75,Spain
CH75,Finland
CH100,Portugal
CH75,United States
CH75,Germany
CH75,Czechia
CH50,Kazakhstan
CH100,Poland
CH75,United States
CH75,Germany
CH75,Italy
CH75,Italy
CH50,Bulgaria
CH125,Mexico
CH75,Colombia
CH50,Greece
CH125,United States
CH75,Bulgaria
CH50,Germany
CH50,Greece
CH75,Italy
CH75,Portugal
CH75,China
CH75,Spain
CH125,Spain
CH100,China
CH100,Italy
CH100,Austria
CH75,Turkiye
CH75,France
CH125,Poland
CH100,China
CH100,France
CH75,United States
CH50,Italy
CH50,Romania
CH125,Austria
CH125,France
CH75,Argentina
CH75,United States
CH50,Romania
CH125,France
CH100,China
CH100,Portugal
CH75,Argentina
CH75,United States
CH100,Spain
CH75,Chile
CH75,United States
CH75,Portugal
CH75,France
CH125,China
CH125,Spain
CH100,France
CH75,Colombia
CH50,United States
CH50,Greece
CH125,Italy
CH75,Brazil
CH75,United States
CH75,China
CH50,Greece
CH125,Brazil
CH100,United States
CH100,France
CH75,China
CH50,Germany
CH100,South Korea
CH75,United States
CH75,Ecuador
CH75,Slovak Republic
CH50,Tunisia
CH75,Peru
CH125,Finland
CH100,Chinese Taipei
CH75,Peru
CH75,Japan
CH50,United States
CH100,Uruguay
CH75,Australia
CH75,Canada
CH75,Japan
CH75,United States
CH75,France
CH100,Italy
CH75,Ecuador
CH75,Brazil
CH75,Australia
CH75,Japan
CH75,Spain
CH50,Egypt
CH100,Chile
CH100,Portugal
CH75,Colombia
CH75,Australia
CH50,Pakistan
CH50,Bahrein
CH50,Greece
")
bycat <- torneos[,.N,by=c('cat','pais')]
View(bycat)
bycoun <- torneos[,.N,by=pais]
View(bycoun)
paisesjugadores <- rank[date_rank=='2025-12-01']
paisesjugadores <- rank[date_rank=='2025-12-01' & rank_position < 101]
View(paisesjugadores)
pyj <- paisesjugadores[,.N,by=country]
View(pyj)
View(torneos)
View(paisesjugadores)
View(paisesjugadores)
paisesjugadores <- rank[date_rank=='2025-12-01' & rank_position < 151]
pyj <- paisesjugadores[,.N,by=country]
paisesjugadores <- rank[date_rank=='2025-12-01' & rank_position < 201]
pyj <- paisesjugadores[,.N,by=country]
View(paisesjugadores)
paisesjugadores <- rank[date_rank=='2025-12-01' & rank_position < 151]
pyj <- paisesjugadores[,.N,by=country]
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
paisesjugadores <- rank[date_rank=='2025-12-01' & rank_position < 1001]
pyj <- paisesjugadores[,.N,by=country]
View(pyj)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
library(data.table)
# Define la ruta del archivo CSV
ruta_csv <- "/Users/paula/Documents/TennisData/TennisData/players_ATP/ATP_DatabaseTML.csv"
# Leer el CSV en un data.table
players_database <- fread(ruta_csv)
# 1. Pasar a minúsculas
players_database[, id := tolower(id)]
# 3. Seleccionar solo las columnas necesarias de players_database
players_subset <- players_database[, .(id, birthdate, weight, height, turnedpro, birthplace, hand, backhand)]
# 4. Merge con repetición automática de valores para jugadores duplicados
rank <- merge(rank,
players_subset,
by.x = "player_id",
by.y = "id",
all.x = TRUE,
sort = FALSE,
allow.cartesian = TRUE)
# 1) Copia de base de partidos
db_complete <- copy(db)
# 2) Preparar ranking con fechas en formato Date
rank[, date_rank := as.Date(date_rank, format = "%d/%m/%Y")]
rank[, player_lower := tolower(player)]
setkey(rank, player_lower, date_rank)
# 3) Preparar claves en db_complete
db_complete[, w_player_lower := tolower(w_player)]
db_complete[, l_player_lower := tolower(l_player)]
# ⚠️ Eliminar partidos sin fecha
db_complete <- db_complete[!is.na(date_match)]
# 4) Rolling join para columnas del jugador ganador
db_complete[, `:=`(
w_rank     = rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.rank_position],
w_birthdate= rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.birthdate],
w_weight   = rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.weight],
w_height   = rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.height],
w_tpro     = rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.turnedpro],
w_hand     = rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.hand],
w_backhand = rank[.SD, on = .(player_lower = w_player_lower, date_rank = date_match),
roll = TRUE, x.backhand]
)]
# 5) Rolling join para columnas del jugador perdedor
db_complete[, `:=`(
l_rank     = rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.rank_position],
l_birthdate= rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.birthdate],
l_weight   = rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.weight],
l_height   = rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.height],
l_tpro     = rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.turnedpro],
l_hand     = rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.hand],
l_backhand = rank[.SD, on = .(player_lower = l_player_lower, date_rank = date_match),
roll = TRUE, x.backhand]
)]
# 6) Limpiar temporales
db_complete[, c("w_player_lower", "l_player_lower") := NULL]
rank[, player_lower := NULL]
# 1) Eliminar columnas temporales (start y end)
db_complete[, c("start", "end") := NULL]
# Primero verificar que existan las columnas necesarias
required_cols <- c("date_match", "w_birthdate", "l_birthdate")
if(all(required_cols %in% colnames(db_complete))){
# Convertir date_match a Date (yyyy-mm-dd)
db_complete$date_match <- as.Date(db_complete$date_match, format = "%Y-%m-%d")
# Asegurarse de que sea carácter antes de convertir
db_complete$w_birthdate <- as.Date(as.character(db_complete$w_birthdate), format = "%Y%m%d")
db_complete$l_birthdate <- as.Date(as.character(db_complete$l_birthdate), format = "%Y%m%d")
db_complete$w_age <- as.numeric(difftime(db_complete$date_match, db_complete$w_birthdate, units = "days")) / 365.25
db_complete$l_age <- as.numeric(difftime(db_complete$date_match, db_complete$l_birthdate, units = "days")) / 365.25
} else {
missing <- required_cols[!(required_cols %in% colnames(db_complete))]
stop(paste("Faltan columnas necesarias:", paste(missing, collapse = ", ")))
}
# 2) Reordenar columnas según el orden deseado
setcolorder(db_complete, c(
"match_id", "tourney_level", "tourney_name", "country", "surface", "round_match", "date_match",
"w_player", "w_nac", "w_age", "w_rank", "w_birthdate", "w_seed", "w_weight", "w_height", "w_tpro", "w_hand", "w_backhand",
"l_player", "l_nac", "l_age", "l_rank", "l_birthdate", "l_seed", "l_weight", "l_height", "l_tpro", "l_hand", "l_backhand",
"timestart", "score", "match_status", "best", "time_total",
"time_1s", "time_2s", "time_3s", "time_4s", "time_5s", "coments", "winner"
))
db <- db_complete
rm(db_complete, rank, players_database, players_subset)
rm(required_cols, ruta_csv, con)
gc()       # libera memoria de forma explícita
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year==2025]
# Paso 1: obtener el campeón de cada torneo (jugador que ganó la final)
campeones <- dbm[round_match == "F", .(campeon = w_player), by = .(year, id)]
# Paso 2: unir con la tabla original para quedarte solo con los partidos donde jugó el campeón
# Es decir, partidos donde el campeón fue w_player o l_player en ese torneo
partidos_campeones <- merge(dbm, campeones, by = c("year", "id"))[
w_player == campeon | l_player == campeon
]
######## Considerando por año
lose_by_year <- partidos_campeones [,.N,by=c('year','l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( year, l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c("year", "l_player"),
by.y = c("year", "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
#### Considernando el total
lose_by_year <- partidos_campeones [,.N,by=c('l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c( "l_player"),
by.y = c( "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
View(lose_by_year)
### Para ver el detalle de quien perdió contra quien
# Tabla detallada: quién perdió contra qué campeón y en qué torneo
tabla_detallada <- partidos_campeones %>%
select(year, id, tourney_name, l_player, campeon, round_match)
# Si quieres que aparezca una fila por cada partido:
tabla_detallada <- tabla_detallada %>%
arrange(year, id, l_player)
# Si prefieres un resumen (cuántas veces perdió cada jugador contra cada campeón en cada torneo):
tabla_resumen <- tabla_detallada %>%
group_by(year, tourney_name, l_player, campeon) %>%
summarise(veces = n(), .groups = "drop") %>%
arrange(desc(veces))
View(tabla_resumen)
library(dplyr)
library(tidyr)
library(data.table)
dbm <- db [tourney_level != 'CH']
dbm <- dbm [match_status != 'Walkover']
dbm <- dbm [round_match != 'Q1' & round_match != 'Q2' & round_match != 'Q3']
dbm <- dbm [tourney_name!= 'United Cup']
dbm[, match_id := sub("_\\d+$", "", match_id)]
dbm <- dbm %>%
separate(match_id, into = c("year", "id"), sep = "_")
setDT(dbm)  # Convierte dbm en data.table si dejó de serlo
dbm[, id := as.character(id)]
dbm <- dbm [year==2025]
# Paso 1: obtener el campeón de cada torneo (jugador que ganó la final)
campeones <- dbm[round_match == "F", .(campeon = w_player), by = .(year, id)]
# Paso 2: unir con la tabla original para quedarte solo con los partidos donde jugó el campeón
# Es decir, partidos donde el campeón fue w_player o l_player en ese torneo
partidos_campeones <- merge(dbm, campeones, by = c("year", "id"))[
w_player == campeon | l_player == campeon
]
######## Considerando por año
lose_by_year <- partidos_campeones [,.N,by=c('year','l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( year, l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c("year", "l_player"),
by.y = c("year", "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
#### Considernando el total
lose_by_year <- partidos_campeones [,.N,by=c('l_player','l_nac')]
derrotas_totales <- dbm[, .(total_losses = .N), by = .( l_player)]
lose_by_year <- merge(
lose_by_year,
derrotas_totales,
by.x = c( "l_player"),
by.y = c( "l_player"),
all.x = TRUE
)
lose_by_year$Perc <- lose_by_year$N / lose_by_year$total_losses *100
### Para ver el detalle de quien perdió contra quien
# Tabla detallada: quién perdió contra qué campeón y en qué torneo
tabla_detallada <- partidos_campeones %>%
select(year, id, tourney_name, l_player, campeon, round_match)
# Si quieres que aparezca una fila por cada partido:
tabla_detallada <- tabla_detallada %>%
arrange(year, id, l_player)
# Si prefieres un resumen (cuántas veces perdió cada jugador contra cada campeón en cada torneo):
tabla_resumen <- tabla_detallada %>%
group_by(year, tourney_name, l_player, campeon) %>%
summarise(veces = n(), .groups = "drop") %>%
arrange(desc(veces))
View(tabla_resumen)
# Cargar librerías
library(DBI)
library(RMariaDB)
library(data.table)
# Establecer la conexión
con <- dbConnect(
MariaDB(),
dbname = "tennis_db",
host = "localhost",
user = "root",
password = "tennis46"
)
# Listar tablas disponibles
dbListTables(con)
# Leo atp_simple
setnames(db <- setDT(dbReadTable(con, "atp_simple")), tolower(names(db)))
# setnames(pbyp <- setDT(dbReadTable(con, "atp_pbyp")), tolower(names(pbyp)))
setnames(rank <- setDT(dbReadTable(con, "atp_rankings")), tolower(names(rank)))
#setnames(db_stats_w_t <- setDT(dbReadTable(con, "atp_stats_w_t")), tolower(names(db_stats_w_t)))
#setnames(db_stats_l_t <- setDT(dbReadTable(con, "atp_stats_l_t")), tolower(names(db_stats_l_t)))
# Cerrar la conexión
dbDisconnect(con)
db <- db[date_match >'2025-01-01']
View(db)
